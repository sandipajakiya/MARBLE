var e=Object.defineProperty,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,l=(e,l)=>{for(var n in l||(l={}))i.call(l,n)&&r(e,n,l[n]);if(t)for(var n of t(l))s.call(l,n)&&r(e,n,l[n]);return e},n=(e,t,i)=>r(e,"symbol"!=typeof t?t+"":t,i),a=(e,t,i)=>new Promise(((s,r)=>{var l=e=>{try{a(i.next(e))}catch(t){r(t)}},n=e=>{try{a(i.throw(e))}catch(t){r(t)}},a=e=>e.done?s(e.value):Promise.resolve(e.value).then(l,n);a((i=i.apply(e,t)).next())}));class o{constructor(e){n(this,"rootElement"),n(this,"elements"),n(this,"filterFields",{}),n(this,"items",[]),n(this,"hiddenInputIntervals",{}),n(this,"state",{activeFilters:{},totalCount:0,resultCount:0,urlParams:new URLSearchParams(window.location.search),filterHistory:[],priceRanges:{}}),n(this,"defaultOperator","OR"),n(this,"maxHistoryLength",10),n(this,"isLoading",!1),n(this,"defaultSortDirection","asc"),n(this,"filterPresets",{}),n(this,"animationQueue",Promise.resolve()),n(this,"settings"),n(this,"isAnimating",!1),this.rootElement=e,this.fetchSettings(),this.elements=this.initializeDOMElements(),this.initialize(),this.handleURLParams(),window.addEventListener("popstate",this.handleURLParams.bind(this)),this.addActiveButtonStyle()}fetchSettings(){try{const e=this.rootElement.getAttribute("fa-cms-filters-settings");if(!e)return void console.warn("No settings found in data attribute");const t=JSON.parse(e);this.settings=t,this.applySettings()}catch(e){console.error("Error fetching settings from data attribute:",e)}}applySettings(){return a(this,null,(function*(){var e,t,i,s,r,l,n;if(!this.settings||"object"!=typeof this.settings)return void console.warn("Invalid settings object");if(document.querySelector('[flowappz-cmsfilters-root="true"]').classList.remove("fa-hide-cms-filter"),(null==(e=this.settings)?void 0:e.customColor)&&document.documentElement.style.setProperty("--cms-filter-color",null==(t=this.settings)?void 0:t.customColor),null==(i=this.settings)?void 0:i.itemsPerRow){const e=document.querySelector('[flowappz-cms-filter-items-wrapper="true"]');e&&(e.style.gridTemplateColumns=`repeat(${null==(s=this.settings)?void 0:s.itemsPerRow}, 1fr)`)}if((null==(r=this.settings)?void 0:r.itemLimit)&&this.items.length>(null==(l=this.settings)?void 0:l.itemLimit))for(let a=null==(n=this.settings)?void 0:n.itemLimit;a<this.items.length;a++)this.items[a].style.display="none"}))}addActiveButtonStyle(){const e=document.querySelector('[flowappz-cms-filter-top="true"]').querySelectorAll("[flowappz-cmsfilter-field]");e.length>0&&e.forEach((e=>{const t=e.parentNode,i=null==t?void 0:t.querySelector("input");(null==i?void 0:i.checked)?e.classList.add("fa-cms-filters-active-tag-template"):e.classList.remove("fa-cms-filters-active-tag-template")}))}initializeDOMElements(){return{filterForms:this.rootElement.querySelectorAll('[flowappz-cmsfilter-element="filters"]'),listWrapper:this.rootElement.querySelector('[flowappz-cmsfilter-element="list"]'),clearButton:this.rootElement.querySelector('[flowappz-cmsfilter-element="clear-filters"]'),clearFilterButtons:document.querySelectorAll("[flowappz-cmsfilter-name]"),templateTag:this.rootElement.querySelector('[flowappz-cmsfilter-element="tag-template"]'),emptyState:this.rootElement.querySelector('[flowappz-cmsfilter-element="empty-state"]'),sortButtons:this.rootElement.querySelectorAll("[flowappz-cmsfilter-sort-button]"),loadingState:this.rootElement.querySelector('[flowappz-cmsfilter-element="loading-state"]'),presetButtons:this.rootElement.querySelectorAll("[flowappz-cmsfilter-preset-button]"),filterCounters:this.rootElement.querySelectorAll("[flowappz-cmsfilter-counter]")}}initialize(){this.elements.filterForms&&this.elements.listWrapper?(this.initializeFilterFields(),this.initializePriceFilters(),this.initializeItems(),this.setupEventListeners(),this.updateState(),this.initializeFilterPresets()):console.error("Filter form or list wrapper not found")}initializeFilterFields(){this.elements.filterForms.forEach((e=>{e.querySelectorAll("[flowappz-cmsfilter-field], .w-radio-input[flowappz-cmsfilter-field]").forEach((e=>{const t=e.getAttribute("flowappz-cmsfilter-field")||"";if(!this.filterFields[t]){const i=e.hasAttribute("flowappz-cmsfilter-price")||t.toLowerCase().includes("price");this.filterFields[t]={elements:[],values:new Set,type:i?"price":void 0}}this.filterFields[t].elements.push(e)}))}))}initializePriceFilters(){this.initializePriceRangeButtons(),this.initializePriceRangeInputs(),this.initializePriceSliders(),this.initializePriceCheckboxes()}initializePriceRangeButtons(){const e=this.rootElement.querySelectorAll("[fs-cmsfilter-field='price-range']");e.forEach((t=>{const i="price";this.filterFields[i]||(this.filterFields[i]={elements:[],values:new Set,type:"price"}),this.state.priceRanges[i]||(this.state.priceRanges[i]=[0,Number.MAX_VALUE]);const s=t.textContent||"";let r=0,l=Number.MAX_VALUE;if(s.includes(" - ")){const e=s.split(" - ");r=Number.parseFloat(e[0].replace(/[^0-9.]/g,"")),l=Number.parseFloat(e[1].replace(/[^0-9.]/g,""))}else s.toLowerCase().includes("under")?l=Number.parseFloat(s.replace(/[^0-9.]/g,"")):s.includes("+")&&(r=Number.parseFloat(s.replace(/[^0-9.]/g,"")));t.addEventListener("click",(s=>{s.preventDefault();const n=t.classList.contains("w--current");e.forEach((e=>{e.classList.remove("w--current")})),n?this.state.priceRanges[i]=[0,Number.MAX_VALUE]:(t.classList.add("w--current"),this.state.priceRanges[i]=[r,l]),this.handleFilterChange()}))}))}initializePriceRangeInputs(){const e=this.rootElement.querySelectorAll("input[data-price-min], input[id*='min'][flowappz-cmsfilter-price]"),t=this.rootElement.querySelectorAll("input[data-price-max], input[id*='max'][flowappz-cmsfilter-price]");e.forEach((e=>{if(!(e instanceof HTMLInputElement))return;const t=e.getAttribute("flowappz-cmsfilter-field")||"price";this.filterFields[t]||(this.filterFields[t]={elements:[],values:new Set,type:"price"}),this.state.priceRanges[t]||(this.state.priceRanges[t]=[0,Number.MAX_VALUE]);const i=Number.parseFloat(e.value);isNaN(i)||(this.state.priceRanges[t][0]=i),e.addEventListener("input",(()=>{const i=Number.parseFloat(e.value);isNaN(i)||(this.state.priceRanges[t][0]=i,this.handleFilterChange())}))})),t.forEach((e=>{if(!(e instanceof HTMLInputElement))return;const t=e.getAttribute("flowappz-cmsfilter-field")||"price";this.filterFields[t]||(this.filterFields[t]={elements:[],values:new Set,type:"price"}),this.state.priceRanges[t]||(this.state.priceRanges[t]=[0,Number.MAX_VALUE]);const i=Number.parseFloat(e.value);isNaN(i)||(this.state.priceRanges[t][1]=i),e.addEventListener("input",(()=>{const i=Number.parseFloat(e.value);isNaN(i)||(this.state.priceRanges[t][1]=i,this.handleFilterChange())}))}))}initializePriceSliders(){this.rootElement.querySelectorAll("input[type='range'][flowappz-cmsfilter-price], input[type='range'][data-price-slider]").forEach((e=>{if(!(e instanceof HTMLInputElement))return;const t=e.getAttribute("flowappz-cmsfilter-field")||"price";this.filterFields[t]||(this.filterFields[t]={elements:[],values:new Set,type:"price"}),this.state.priceRanges[t]||(this.state.priceRanges[t]=[0,Number.MAX_VALUE]);let i=Number.parseFloat(e.min)||0,s=Number.parseFloat(e.max)||100;if(0===i&&100===s){let r=Number.MAX_VALUE,l=0;this.items.forEach((e=>{const i=e.querySelector(`[flowappz-cmsfilter-field="${t}"]`);if(!i)return;let s=i.textContent||"";s=s.replace(/[^\d.-]/g,"");const n=Number.parseFloat(s);isNaN(n)||(r=Math.min(r,n),l=Math.max(l,n))})),i=Math.floor(r),s=Math.ceil(l),e.min=i.toString(),e.max=s.toString()}const r=Number.parseFloat(e.value);if(!isNaN(r)){const i=e.hasAttribute("data-price-min")||e.id.toLowerCase().includes("min");e.hasAttribute("data-price-max")||e.id.toLowerCase().includes("max");i?this.state.priceRanges[t][0]=r:this.state.priceRanges[t][1]=r}e.addEventListener("input",(()=>{const i=Number.parseFloat(e.value);if(!isNaN(i)){const s=e.hasAttribute("data-price-min")||e.id.toLowerCase().includes("min");e.hasAttribute("data-price-max")||e.id.toLowerCase().includes("max");s?this.state.priceRanges[t][0]=i:this.state.priceRanges[t][1]=i,this.handleFilterChange()}}))}))}initializePriceCheckboxes(){this.rootElement.querySelectorAll("input[type='checkbox'][flowappz-cmsfilter-price], input[type='radio'][flowappz-cmsfilter-price]").forEach((e=>{if(!(e instanceof HTMLInputElement))return;const t=e.getAttribute("flowappz-cmsfilter-field")||"price";this.filterFields[t]||(this.filterFields[t]={elements:[],values:new Set,type:"price"}),this.state.priceRanges[t]||(this.state.priceRanges[t]=[0,Number.MAX_VALUE]);let i=e.getAttribute("data-price-range")||e.value;if(!i){const t=e.closest("label");t&&(i=t.textContent||"")}let s=0,r=Number.MAX_VALUE;if(i)if(i.includes("-")){const e=i.split("-");s=Number.parseFloat(e[0].replace(/[^0-9.]/g,"")),r="max"===e[1].toLowerCase()?Number.MAX_VALUE:Number.parseFloat(e[1].replace(/[^0-9.]/g,""))}else i.toLowerCase().includes("under")?r=Number.parseFloat(i.replace(/[^0-9.]/g,"")):i.includes("+")&&(s=Number.parseFloat(i.replace(/[^0-9.]/g,"")));e.addEventListener("change",(()=>{if(e.checked){if(this.state.priceRanges[t]=[s,r],"radio"===e.type){const t=e.name;if(t){this.rootElement.querySelectorAll(`input[type="radio"][name="${t}"]`).forEach((t=>{t!==e&&t instanceof HTMLInputElement&&(t.checked=!1)}))}}}else"checkbox"===e.type&&(this.state.priceRanges[t]=[0,Number.MAX_VALUE]);this.handleFilterChange()})),e.checked&&(this.state.priceRanges[t]=[s,r])}))}checkPriceMatch(e,t,i){const[s,r]=i.split("-"),l=Number.parseFloat(s),n=Number.parseFloat(r),a=e.querySelector(`[flowappz-cmsfilter-field="${t}"]`);if(!a)return!1;let o=a.textContent||"";o=o.replace(/[^\d.-]/g,"");const c=Number.parseFloat(o);return!isNaN(c)&&(c>=l&&(n===Number.MAX_VALUE||c<=n))}initializeItems(){this.items=Array.from(this.elements.listWrapper.querySelectorAll("[fa-collection-wrapper]"))}setupEventListeners(){this.setupFilterFormListeners(),this.setupHiddenInputMonitoring(),this.setupClearButtonListeners(),this.setupPresetListeners()}setupFilterFormListeners(){const{filterForms:e}=this.elements;e&&0!==e.length&&e.forEach((e=>{e.addEventListener("input",this.handleFilterChange.bind(this));const t=e.querySelector("form.w-form");t&&t.addEventListener("submit",(e=>(e.preventDefault(),e.stopPropagation(),!1)),!0),e.addEventListener("submit",(e=>(e.preventDefault(),e.stopPropagation(),!1)),!0),e.addEventListener("keypress",(e=>{if("Enter"===e.key)return e.preventDefault(),e.stopPropagation(),!1}),!0),e.addEventListener("reset",(e=>{e.preventDefault(),this.handleClearFilters()}),!0)}))}setupClearButtonListeners(){const{clearButton:e,clearFilterButtons:t}=this.elements;e&&e.addEventListener("click",this.handleClearFilters.bind(this)),t.forEach((e=>{const t=e.getAttribute("flowappz-cmsfilter-name");t&&e.addEventListener("click",(()=>this.clearFilter(t)))}))}setupHiddenInputMonitoring(){Object.entries(this.filterFields).forEach((([e,t])=>{t.elements.forEach((t=>this.monitorHiddenInput(t,e)))}))}monitorHiddenInput(e,t){let i=e.value;this.hiddenInputIntervals[t]=window.setInterval((()=>{const s=e.value;if(s!==i){if(i){const i=new CustomEvent("hiddenInputChange",{detail:{fieldName:t,value:s}});e.dispatchEvent(i)}i=s}}),100),e.addEventListener("hiddenInputChange",(e=>{this.handleHiddenInputChange(e)}))}handleHiddenInputChange(e){e.detail,this.handleFilterChange()}getInputValue(e){var t,i,s;if(e instanceof HTMLSelectElement){const t=e.options[e.selectedIndex];return t?t.text.trim().toLowerCase():""}const r=e.closest("label.w-checkbox, label.w-radio");if(r)return(null==(t=r.textContent)?void 0:t.trim().toLowerCase())||"";if(e.classList.contains("w-radio-input")){const t=e.nextElementSibling;return(null==(s=null==(i=null==t?void 0:t.parentElement)?void 0:i.textContent)?void 0:s.trim().toLowerCase())||""}return e.value.trim().toLowerCase()}isInputActive(e){if("text"===e.type||"hidden"===e.type)return""!==e.value.trim();if(e instanceof HTMLSelectElement)return e.selectedIndex>0;const t=e.closest("label.w-checkbox, label.w-radio"),i=null==t?void 0:t.querySelector("input");return"checkbox"===(null==i?void 0:i.type)||"radio"===(null==i?void 0:i.type)?i.checked:!!e.classList.contains("w-radio-input")&&e.classList.contains("w--redirected-checked")}clearInput(e){var t;const i=e.closest("label.w-checkbox, label.w-radio"),s=null==i?void 0:i.querySelector(".w-checkbox-input--inputType-custom, .w-form-formradioinput--inputType-custom"),r=null==i?void 0:i.querySelector("input");if("checkbox"===(null==r?void 0:r.type)||"radio"===(null==r?void 0:r.type))null==s||s.classList.remove("w--redirected-checked"),r.checked=!1;else if(e instanceof HTMLSelectElement)e.selectedIndex=0;else if(e.classList.contains("w-radio-input")){e.classList.remove("w--redirected-checked");const t=e.nextElementSibling;t&&(t.checked=!1)}else e.value="";const l=e.getAttribute("flowappz-cmsfilter-field")||"";"price"===(null==(t=this.filterFields[l])?void 0:t.type)&&(e.hasAttribute("data-price-min")||e.id.toLowerCase().includes("min")?this.state.priceRanges[l]&&(this.state.priceRanges[l][0]=0):(e.hasAttribute("data-price-max")||e.id.toLowerCase().includes("max"))&&this.state.priceRanges[l]&&(this.state.priceRanges[l][1]=Number.MAX_VALUE))}updateState(){return a(this,null,(function*(){this.showLoading(),this.state.activeFilters=this.getActiveFilters(),this.addActiveButtonStyle(),this.updateFilterHistory(),this.updateURLParams(),yield this.updateFilteredItems(),this.updateCounters(),this.updateEmptyState(),this.updateActiveTags(),this.updateCounts(),this.hideLoading()}))}parseSearchFields(e){if("*"===e)return{fields:["*"],value:""};return{fields:e.split(",").map((e=>e.trim())),value:""}}getActiveFilters(){const e={};return Object.entries(this.filterFields).forEach((([t,i])=>{if("price"===i.type){const i=this.state.priceRanges[t];return void(i&&(i[0]>0||i[1]<Number.MAX_VALUE)&&(e[t]=[`${i[0]}-${i[1]}`]))}const s=i.elements.filter((e=>"text"===e.type||"search"===e.type?""!==e.value.trim():this.isInputActive(e))).map((e=>this.getInputValue(e))).filter((e=>""!==e));if(s.length>0){this.parseSearchFields(t).fields.length>0&&(e[t]=s)}})),e}updateFilteredItems(){return a(this,null,(function*(){const e=Array.from(this.items),t=[],i=[];e.forEach((e=>{this.checkItemVisibility(e)?t.push(e):i.push(e)})),i.forEach((e=>{e.style.display="none"})),t.forEach(((e,t)=>{t<this.settings.itemLimit?e.style.display="":e.style.display="none"}))}))}checkItemVisibility(e){if(0===Object.keys(this.state.activeFilters).length)return!0;const t=this.groupActiveFilters();return Object.entries(t).every((([t,i])=>{if(0===i.length)return!0;const s=this.filterFields[t];if("price"===(null==s?void 0:s.type))return this.checkPriceMatch(e,t,i[0]);const r=(null==s?void 0:s.operator)||this.defaultOperator,l=this.parseSearchFields(t);return l.fields.includes("*")?"OR"===r?i.some((t=>this.checkGlobalSearch(e,t))):i.every((t=>this.checkGlobalSearch(e,t))):l.fields.some((t=>"OR"===r?i.some((i=>this.checkFieldMatch(e,t,[i]))):i.every((i=>this.checkFieldMatch(e,t,[i])))))}))}groupActiveFilters(){const e={};return Object.entries(this.state.activeFilters).forEach((([t,i])=>{var s;if("price"===(null==(s=this.filterFields[t])?void 0:s.type))return e[t]||(e[t]=[]),void(e[t]=i);this.parseSearchFields(t).fields.forEach((t=>{e[t]||(e[t]=[]),i.forEach((i=>{""!==i.trim()&&e[t].push(i.trim())}))}))})),e}checkFieldMatch(e,t,i){const s=e.querySelectorAll(`[flowappz-cmsfilter-field="${t}"]`);if(0===s.length)return!1;const r=Array.from(s).map((e=>(e.textContent||"").trim().toLowerCase()));return i.some((e=>{const t=e.toLowerCase();return r.some((e=>e.includes(t)))}))}checkGlobalSearch(e,t){if(!t.trim())return!0;const i=e.querySelectorAll("[flowappz-cmsfilter-field]"),s=Array.from(i).map((e=>(e.textContent||"").trim().toLowerCase())),r=e.textContent||"";s.push(r.trim().toLowerCase());const l=t.toLowerCase();return s.some((e=>e.includes(l)))}updateActiveTags(){if(!this.elements.templateTag)return;this.elements.templateTag.style.display="none",this.removeExistingTags();const e=this.getValidTags();e.length>0&&(this.elements.templateTag.style.display="inline-block",this.createTags(e))}getValidTags(){const e=[];return Object.entries(this.state.activeFilters).forEach((([t,i])=>{var s;if("price"!==(null==(s=this.filterFields[t])?void 0:s.type))i.forEach((i=>{const s=this.filterFields[t];if(!s)return;s.elements.some((e=>this.getInputValue(e)===i.toLowerCase()&&this.isInputActive(e)))&&e.push({fieldName:t,value:i})}));else{const s=i[0].split("-");if(2===s.length){const i=Number.parseFloat(s[0]),r=Number.parseFloat(s[1]);let l=`$${i}`;r<Number.MAX_VALUE?l+=` - $${r}`:l+="+",e.push({fieldName:t,value:l})}}})),e}createTags(e){this.elements.templateTag&&e.forEach((e=>{var t;const i=this.elements.templateTag.cloneNode(!0);i.style.display="inline-block";const s=i.querySelector('[flowappz-cmsfilter-element="tag-text"]');s&&(s.textContent=`${e.fieldName}: ${e.value}`);const r=i.querySelector('[flowappz-cmsfilter-element="tag-remove"]');r&&r.addEventListener("click",(()=>this.removeTag(e))),null==(t=this.elements.templateTag.parentNode)||t.appendChild(i)}))}handleFilterChange(e){return a(this,null,(function*(){var t;if(null==(t=this.settings)?void 0:t.showTopCheckBoxes){const t=document.querySelector('[flowappz-cms-filter-top="true"]').querySelectorAll("input");e&&t.length>0&&t.forEach((t=>{t!==e.target&&(t.checked=!1)}))}if(this.isAnimating)return;const i=this.state.resultCount;yield this.updateState(),Math.abs(this.state.resultCount-i)>5&&requestAnimationFrame((()=>{this.smoothScrollToTop()}))}))}handleClearFilters(){Object.values(this.filterFields).forEach((e=>{e.elements.forEach((e=>this.clearInput(e))),e.values.clear()})),Object.keys(this.state.priceRanges).forEach((e=>{this.state.priceRanges[e]=[0,Number.MAX_VALUE]}));this.rootElement.querySelectorAll("[fs-cmsfilter-field='price-range']").forEach((e=>{e.classList.remove("w--current")}));this.rootElement.querySelectorAll("input[flowappz-cmsfilter-price], input[data-price-min], input[data-price-max]").forEach((e=>{e instanceof HTMLInputElement&&("checkbox"===e.type||"radio"===e.type?e.checked=!1:"range"===e.type?e.value=e.min||"0":e.value="")})),this.updateState()}clearFilter(e){const t=this.filterFields[e];if(t){if(t.elements.forEach((e=>this.clearInput(e))),t.values.clear(),"price"===t.type&&this.state.priceRanges[e]){this.state.priceRanges[e]=[0,Number.MAX_VALUE];this.rootElement.querySelectorAll(`[data-price-field="${e}"]`).forEach((e=>{e.classList.remove("active")}));const t=this.rootElement.querySelector(`[data-price-slider][data-price-field="${e}"] .price-slider`);t&&t.min&&(t.value=t.min)}this.updateState()}}removeTag(e){const t=this.filterFields[e.fieldName];if(t){if("price"===t.type){this.state.priceRanges[e.fieldName]=[0,Number.MAX_VALUE];this.rootElement.querySelectorAll(`[data-price-field="${e.fieldName}"]`).forEach((e=>{e.classList.remove("active")}));const i=this.rootElement.querySelector(`[data-price-slider][data-price-field="${e.fieldName}"] .price-slider`);i&&i.min&&(i.value=i.min),t.elements.forEach((e=>{this.clearInput(e)}))}else t.elements.forEach((t=>{this.getInputValue(t)===e.value.toLowerCase()&&this.isInputActive(t)&&this.clearInput(t)}));this.removeTagElement(e),this.updateState()}}removeTagElement(e){this.rootElement.querySelectorAll('[flowappz-cmsfilter-element="tag-template"]').forEach((t=>{const i=t.querySelector('[flowappz-cmsfilter-element="tag-text"]');i&&i.textContent===`${e.fieldName}: ${e.value}`&&t.remove()}))}removeExistingTags(){this.rootElement.querySelectorAll('[flowappz-cmsfilter-element="tag-template"]').forEach((e=>{e!==this.elements.templateTag&&e.remove()}))}destroy(){Object.values(this.hiddenInputIntervals).forEach((e=>clearInterval(e))),this.removeEventListeners(),this.items.forEach((e=>{e.style.cssText=""})),this.elements.listWrapper&&(this.elements.listWrapper.style.cssText="")}removeEventListeners(){this.elements.filterForms&&this.elements.filterForms.forEach((e=>e.removeEventListener("input",this.handleFilterChange))),this.elements.clearButton&&this.elements.clearButton.removeEventListener("click",this.handleClearFilters),Object.entries(this.filterFields).forEach((([e,t])=>{t.elements.forEach((e=>{e.removeEventListener("hiddenInputChange",this.handleHiddenInputChange)}))}))}updateCounts(){return a(this,null,(function*(){var e;const t=this.rootElement.getAttribute("fa-cms-filters-settings");if(!t)return void console.warn("No settings found in data attribute");const i=JSON.parse(t);this.state.totalCount=this.items.length,(null==i?void 0:i.itemLimit)<(null==(e=null==this?void 0:this.items)?void 0:e.length)&&(this.state.totalCount=null==i?void 0:i.itemLimit),this.state.resultCount=this.items.filter((e=>"none"!==e.style.display)).length,(null==i?void 0:i.itemLimit)<this.state.resultCount&&(this.state.resultCount=null==i?void 0:i.itemLimit);const s=this.rootElement.querySelector('[flowappz-cmsfilter-element="total-count"]'),r=this.rootElement.querySelector('[flowappz-cmsfilter-element="result-count"]');s&&(s.textContent=this.state.totalCount.toString()),r&&(r.textContent=this.state.resultCount.toString())}))}handleURLParams(){this.state.urlParams=new URLSearchParams(window.location.search),this.handleClearFilters(),this.state.urlParams.forEach(((e,t)=>{var i;if("price"===(null==(i=this.filterFields[t])?void 0:i.type)){const[i,s]=e.split("-").map(Number.parseFloat);if(!isNaN(i)&&!isNaN(s)){this.state.priceRanges[t]=[i,s];const e=this.filterFields[t].elements.find((e=>e.hasAttribute("data-price-min")||e.id.toLowerCase().includes("min"))),r=this.filterFields[t].elements.find((e=>e.hasAttribute("data-price-max")||e.id.toLowerCase().includes("max")));e&&(e.value=i.toString()),r&&(r.value=s.toString());this.rootElement.querySelectorAll(`[data-price-field="${t}"][data-price-range]`).forEach((e=>{e.getAttribute("data-price-range")===`${i}-${s===Number.MAX_VALUE?"max":s}`&&e.classList.add("active")}))}return}const s=e.split(","),r=this.filterFields[t];r&&r.elements.forEach((t=>{var i;const r=this.getInputValue(t).toLowerCase();if(s.includes(r))if("checkbox"===t.type||"radio"===t.type){t.checked=!0;const e=null==(i=t.parentElement)?void 0:i.querySelector(".w-checkbox-input, .w-radio-input");e&&e.classList.add("w--redirected-checked")}else t.value=e}))})),this.updateState()}updateURLParams(){const e=new URLSearchParams;Object.entries(this.state.activeFilters).forEach((([t,i])=>{i.length>0&&e.set(t,i.join(","))}));const t=e.toString()?`${window.location.pathname}?${e.toString()}`:window.location.pathname;window.history.pushState({},"",t)}initializeFilterPresets(){this.rootElement.querySelectorAll("[flowappz-cmsfilter-preset]").forEach((e=>{const t=e.getAttribute("flowappz-cmsfilter-preset");if(t){const i=this.parsePresetFilters(e);this.filterPresets[t]={name:t,filters:i}}}))}parsePresetFilters(e){const t={},i=e.getAttribute("flowappz-cmsfilter-preset-data");if(i)try{const e=JSON.parse(i);Object.entries(e).forEach((([e,i])=>{t[e]=Array.isArray(i)?i:[i]}))}catch(s){console.error("Error parsing preset filters:",s)}return t}setupPresetListeners(){this.rootElement.querySelectorAll("[flowappz-cmsfilter-preset-button]").forEach((e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("flowappz-cmsfilter-preset-button");t&&this.applyPreset(t)}))}))}applyPreset(e){const t=this.filterPresets[e];t&&(this.handleClearFilters(),this.state.currentPreset=e,Object.entries(t.filters).forEach((([e,t])=>{var i;if("price"===(null==(i=this.filterFields[e])?void 0:i.type)&&t.length>0){const[i,s]=t[0].split("-").map(Number.parseFloat);if(!isNaN(i)&&!isNaN(s)){this.state.priceRanges[e]=[i,s];const t=this.filterFields[e].elements.find((e=>e.hasAttribute("data-price-min")||e.id.toLowerCase().includes("min"))),r=this.filterFields[e].elements.find((e=>e.hasAttribute("data-price-max")||e.id.toLowerCase().includes("max")));t&&(t.value=i.toString()),r&&(r.value=s.toString());this.rootElement.querySelectorAll(`[data-price-field="${e}"][data-price-range]`).forEach((e=>{e.getAttribute("data-price-range")===`${i}-${s===Number.MAX_VALUE?"max":s}`&&e.classList.add("active")}))}return}const s=this.filterFields[e];s&&s.elements.forEach((e=>{const i=this.getInputValue(e).toLowerCase();t.includes(i)&&this.setInputValue(e,i)}))})),this.updateState())}setInputValue(e,t){var i;if("checkbox"===e.type||"radio"===e.type){e.checked=!0;const t=null==(i=e.parentElement)?void 0:i.querySelector(".w-checkbox-input, .w-radio-input");t&&t.classList.add("w--redirected-checked")}else if(e instanceof HTMLSelectElement){const i=Array.from(e.options).find((e=>e.text.trim().toLowerCase()===t));i&&(e.selectedIndex=i.index)}else e.value=t}handleSort(e){return a(this,arguments,(function*(e,t=this.defaultSortDirection){this.showLoading(),this.state.sortField=e,this.state.sortDirection=t,yield this.sortItems(),this.updateURLParams(),this.hideLoading()}))}sortItems(){return a(this,null,(function*(){if(!this.state.sortField)return;const e=Array.from(this.items).sort(((e,t)=>{const i=this.getSortValue(e,this.state.sortField),s=this.getSortValue(t,this.state.sortField);return("asc"===this.state.sortDirection?1:-1)*this.compareValues(i,s)})),t=this.items[0].parentElement;t&&e.forEach((e=>t.appendChild(e))),this.items=e}))}compareValues(e,t){const i=Number.parseFloat(e),s=Number.parseFloat(t);return isNaN(i)||isNaN(s)?e.localeCompare(t):i-s}getSortValue(e,t){const i=e.querySelector(`[flowappz-cmsfilter-field="${t}"]`);return((null==i?void 0:i.textContent)||"").trim().toLowerCase()}showLoading(){this.isLoading=!0,this.elements.loadingState&&(this.elements.loadingState.style.display="flex"),this.elements.listWrapper&&(this.elements.listWrapper.style.opacity="1",this.elements.listWrapper.style.pointerEvents="none")}hideLoading(){this.isLoading=!1,this.elements.loadingState&&(this.elements.loadingState.style.display="none"),this.elements.listWrapper&&(this.elements.listWrapper.style.opacity="1",this.elements.listWrapper.style.pointerEvents="auto")}updateFilterHistory(){const e={filters:l({},this.state.activeFilters),sort:this.state.sortField,direction:this.state.sortDirection};this.state.filterHistory.unshift(e),this.state.filterHistory.length>this.maxHistoryLength&&this.state.filterHistory.pop()}updateEmptyState(){if(!this.elements.emptyState||!this.elements.listWrapper)return;const e=this.items.some((e=>"none"!==e.style.display));this.elements.emptyState.style.display=e?"none":"block",this.elements.listWrapper.style.display=e?"block":"none"}updateCounters(){this.elements.filterCounters.forEach((e=>{const t=e.getAttribute("flowappz-cmsfilter-counter");if(t){const i=this.getFilterCount(t);e.textContent=i.toString(),e.style.display=0===i?"none":"inline-block"}}))}getFilterCount(e){return this.items.filter((t=>t.querySelectorAll(`[flowappz-cmsfilter-field="${e}"]`).length>0&&"none"!==t.style.display)).length}smoothScrollToTop(){const e={top:0,behavior:"smooth"},t=this.findScrollableParent(this.elements.listWrapper);if(t)try{t.scrollTo(e)}catch(i){t.scrollTop=0}else try{window.scrollTo(e)}catch(i){window.scrollTo(0,0)}}findScrollableParent(e){if(console.log(this.isLoading,this.animationQueue,this.handleSort("")),!e)return null;const t=e=>{const t=e.scrollHeight>e.clientHeight,i=window.getComputedStyle(e).overflowY;return t&&("scroll"===i||"auto"===i)};let i=e.parentElement;for(;i;){if(t(i))return i;i=i.parentElement}return null}}document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll("[flowappz-cmsfilters-root]").forEach((e=>new o(e)))}));
